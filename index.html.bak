<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Magic Garden V18 (Stable)</title>
    
    <!-- 1. 核心库 (CDN) - 必须按顺序加载 -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/camera_utils/camera_utils.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>

    <link rel="stylesheet" href="./style.css">
    
    <style>
        /* 错误日志条 */
        #error-console {
            position: fixed; top: 0; left: 0; width: 100%; background: rgba(200, 0, 0, 0.9);
            color: white; font-size: 12px; padding: 10px; z-index: 99999; display: none;
        }
    </style>
</head>
<body>
    <!-- 错误显示 -->
    <div id="error-console"></div>

    <!-- 背景 -->
    <div id="sky-gradient"></div>

    <!-- 1. 启动大厅 -->
    <div id="lobby-screen">
        <div class="logo-area">
            <h1>🌸 奇幻花园</h1>
            <p>V18 稳定修复版</p>
        </div>

        <div class="tree-container">
            <div id="magic-tree">🌳</div>
            <div class="tree-stats">等级: <span id="user-lvl">1</span> | 分数: <span id="total-score">0</span></div>
        </div>

        <div class="level-scroller">
            <button onclick="startGame('animals')" style="--theme:#ff6348">🦁<br>动物</button>
            <button onclick="startGame('fruits')" style="--theme:#ff9f43">🍎<br>水果</button>
            <button onclick="startGame('colors')" style="--theme:#70a1ff">🎨<br>颜色</button>
            <button onclick="startGame('numbers')" style="--theme:#1dd1a1">🔢<br>数字</button>
            <button onclick="startGame('body')" style="--theme:#feca57">👀<br>身体</button>
            <button onclick="startGame('vehicles')" style="--theme:#6c5ce7">🚗<br>交通</button>
        </div>

        <div id="system-log">⏳ 系统初始化中...</div>
    </div>

    <!-- 2. 游戏 HUD -->
    <div id="game-ui">
        <div class="hud-header">
            <div class="score-badge">✨ <span id="game-score">0</span></div>
            <div class="combo-badge" id="combo-display" style="opacity:0">⭐ Combo!</div>
            <button class="quit-btn" onclick="location.reload()">🏠 退出</button>
        </div>

        <!-- 学习卡片 -->
        <div id="study-modal">
            <div class="modal-card">
                <div id="card-icon">🍎</div>
                <h2 id="card-en">APPLE</h2>
                <div id="card-pron">/ˈæp.l/</div>
                <h3 id="card-cn">苹果</h3>
                
                <div class="mic-area">
                    <div id="mic-status">🎤 点击麦克风跟读</div>
                    <button id="btn-mic" onclick="startSpeech()">🎙️</button>
                    <button id="btn-skip" onclick="closeCard()">跳过</button>
                </div>
            </div>
        </div>
        
        <div id="vfx-container"></div>
    </div>

    <!-- 3. iOS 视频修复 -->
    <video id="input-video" playsinline webkit-playsinline muted autoplay></video>
    
    <!-- 4. 调试雷达 -->
    <canvas id="radar-canvas" width="120" height="90"></canvas>

    <!-- 5. 主画布 -->
    <canvas id="webgl-canvas"></canvas>

    <!-- 注意：这里不加 type="module"，当作普通脚本执行 -->
    <script src="./main.js"></script>

    <script>
        // 全局错误捕获
        window.onerror = function(msg, url, line) {
            const el = document.getElementById('error-console');
            el.style.display = 'block';
            el.innerText = `❌ 错误: ${msg} (Line: ${line})`;
            return false;
        };
    </script>
</body>
</html>